<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <h1>Welcome, <%= user.displayname %>!</h1>
  <img src="<%= user.image.versions.small %>" alt="Your Profile Picture">

  <h2>Check Your Friend's Campus Status</h2>
  <form id="search-form">
    <label for="username">Enter 42 Username:</label>
    <input type="text" id="username" name="username" required>
    <button type="submit">Check Status</button>
  </form>

  <div id="result"></div>
    <script>
        document.getElementById("search-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            const username = document.getElementById("username").value;
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = ""; // Clear previous results

            try {
                const response = await axios.post("/check-user", { username }, {
                    headers: { "Content-Type": "application/json" }
                });

                if (response.data.error) {
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå ${response.data.error}</p>`;
                    return;
                }

                resultDiv.innerHTML = `<p style="color: ${response.data.online ? 'green' : 'red'};">${response.data.status_message}</p>`;

            } catch (error) {
                console.error("Error:", error);
                resultDiv.innerHTML = `<p style="color: red;">An error occurred. Please try again.</p>`;
            }
        });
    </script>

    </body>
</html>